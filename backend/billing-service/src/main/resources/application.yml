# Server configuration
server:
  port: ${PORT:8084}
  error:
    include-stacktrace: always

# Actuator configuration for health checks
management:
  endpoints:
    web:
      exposure:
        include: health,info
      base-path: /actuator
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true
  server:
    port: ${PORT:8084}

spring:
  application:
    name: billing-service

  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        default_schema: billing
        format_sql: true
    show-sql: false

  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:railway}
    username: ${DB_USER:postgres}
    password: ${DB_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver
    hikari:
      pool-name: BillingPool
      minimum-idle: 1
      maximum-pool-size: 3
      idle-timeout: 30000
      connection-timeout: 20000

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    schemas: billing
    default-schema: billing
    create-schemas: true
    repair: true

  mail:
    host: ${MAIL_HOST:smtp.gmail.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:user@example.com}
    password: ${MAIL_PASSWORD:password}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html

# SII Configuration
sii:
  mock-mode: ${SII_MOCK_MODE:true}
  environment: ${SII_ENVIRONMENT:certificacion}
  ambiente: certificacion  # certificacion | produccion
  urls:
    certificacion:
      auth: https://maullin.sii.cl/cgi_dte/UPL/DTEUpload
      consulta: https://maullin.sii.cl/cgi_dte/consultaDte
      token: https://maullin.sii.cl/cgi_dte/gettoken.jws
    produccion:
      auth: https://palena.sii.cl/cgi_dte/UPL/DTEUpload
      consulta: https://palena.sii.cl/cgi_dte/consultaDte
      token: https://palena.sii.cl/cgi_dte/gettoken.jws

# Logging
logging:
  level:
    com.poscl.billing: DEBUG
    org.springframework.web: INFO
